<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Tabs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .tab {
            display: none;
        }
        .tab-header {
            display: inline-block;
            cursor: pointer;
            padding: 10px;
            background-color: #f1f1f1;
            margin-right: 10px;
        }
        .tab-header.active {
            background-color: #ccc;
        }
        .tab-content {
            padding: 10px;
            border: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

<div class="tab-header" onclick="showTab('general')">General Testing</div>
<div class="tab-header" onclick="showTab('security')">Security Testing</div>

<div id="general" class="tab">
    <div class="tab-content">
        <h2>General Testing</h2>
        <form id="generalForm">
            <label for="codeFile">Upload Code:</label>
            <input type="file" id="codeFile" name="codeFile"><br><br>
            <label for="postmanFile">Upload Postman Collection:</label>
            <input type="file" id="postmanFile" name="postmanFile"><br><br>
            <button type="button" onclick="submitFiles()">Submit</button>
        </form>
        <div id="result"></div>
    </div>
</div>

<div id="security" class="tab">
    <div class="tab-content">
        <h2>Security Testing</h2>
        <form id="securityForm">
            <label for="securityInput">Enter Security Data:</label>
            <input type="text" id="securityInput" name="securityInput"><br><br>
            <button type="button" onclick="submitSecurity()">Submit</button>
        </form>
        <div id="securityResult"></div>
    </div>
</div>

<script>
    function showTab(tabName) {
        document.querySelectorAll('.tab').forEach(tab => {
            tab.style.display = 'none';
        });
        document.querySelectorAll('.tab-header').forEach(header => {
            header.classList.remove('active');
        });
        document.getElementById(tabName).style.display = 'block';
        event.currentTarget.classList.add('active');
    }

    function submitFiles() {
        const formData = new FormData();
        const codeFile = document.getElementById('codeFile').files[0];
        const postmanFile = document.getElementById('postmanFile').files[0];
        
        if (codeFile) formData.append('codeFile', codeFile);
        if (postmanFile) formData.append('postmanFile', postmanFile);
        
        fetch('/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            displayResult(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function submitSecurity() {
        const securityInput = document.getElementById('securityInput').value;
        
        fetch('/security', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ securityInput }),
        })
        .then(response => response.json())
        .then(data => {
            displaySecurityResult(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function displayResult(data) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';
        data.forEach((item, index) => {
            const table = document.createElement('table');
            const headerRow = document.createElement('tr');
            
            for (const key in item) {
                const th = document.createElement('th');
                th.innerText = key;
                headerRow.appendChild(th);
            }
            table.appendChild(headerRow);

            const dataRow = document.createElement('tr');
            for (const key in item) {
                const td = document.createElement('td');
                td.innerText = item[key];
                dataRow.appendChild(td);
            }
            table.appendChild(dataRow);

            resultDiv.appendChild(table);
        });
    }

    function displaySecurityResult(data) {
        const securityResultDiv = document.getElementById('securityResult');
        securityResultDiv.innerHTML = '';

        if (!Array.isArray(data)) {
            securityResultDiv.innerHTML = '<p>No vulnerabilities found.</p>';
            return;
        }

        const table = document.createElement('table');
        const headerRow = document.createElement('tr');

        // Add table headers
        const headers = ['alert', 'description', 'risk', 'solution', 'reference', 'url'];
        headers.forEach(header => {
            const th = document.createElement('th');
            th.innerText = header;
            headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        // Add table rows
        data.forEach(item => {
            const row = document.createElement('tr');
            headers.forEach(header => {
                const td = document.createElement('td');
                td.innerText = item[header];
                row.appendChild(td);
            });
            table.appendChild(row);
        });

        securityResultDiv.appendChild(table);
    }

    document.addEventListener('DOMContentLoaded', () => {
        showTab('general');
    });
</script>

</body>
</html>
